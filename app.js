"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));Object.defineProperty(exports,"__esModule",{value:!0});var Koa=require("koa"),app=new Koa,views=require("koa-views"),json=require("koa-json"),bodyparser=require("koa-bodyparser"),logger=require("koa-logger"),onerror=require("koa-onerror"),koaStatic=require("koa-static"),koaMount=require("koa-mount"),util=require("util"),Glob=require("glob"),config_1=require("./config"),sequelize_1=require("./sequelize"),task_1=require("./task"),responseMessage_1=require("./lib/responseMessage"),glob=util.promisify(Glob);onerror(app),app.use(bodyparser({enableTypes:["json","form","text"]})),app.use(json()),app.use(logger()),app.use(koaMount(config_1.default.STATIC.prefix,koaStatic(config_1.default.STATIC.dir))),app.use(views(config_1.default.VIEW.dir,{extension:"ejs"})),app.use(function(e,r){var a;return _regenerator.default.async(function(e){for(;;)switch(e.prev=e.next){case 0:return a=+new Date,e.next=3,_regenerator.default.awrap(r());case 3:new Date-a;case 5:case"end":return e.stop()}})}),glob(__dirname+"/controller/*.js").then(function(e){return Promise.all(e.map(function(e){return Promise.resolve().then(function(){return require(e)})}))}).then(function(e){e.forEach(function(e,r){e.default(app)})}).catch(function(e){}),"dev"===process.env.NODE_ENV&&(task_1.copyStaticResource(),task_1.createStaticDir());var responseMessage=new responseMessage_1.default;Object.assign(app,{responseMessage:responseMessage}),Object.assign(app,{sequelize:sequelize_1.default}),app.on("error",function(e,r){}),exports.default=app;