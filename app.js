"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const Koa=require("koa"),app=new Koa,views=require("koa-views"),json=require("koa-json"),bodyparser=require("koa-bodyparser"),logger=require("koa-logger"),onerror=require("koa-onerror"),koaStatic=require("koa-static"),koaMount=require("koa-mount"),util=require("util"),Glob=require("glob"),config_1=require("./config"),sequelize_1=require("./sequelize"),task_1=require("./task"),responseMessage_1=require("./lib/responseMessage"),glob=util.promisify(Glob);onerror(app),app.use(bodyparser({enableTypes:["json","form","text"]})),app.use(json()),app.use(logger()),app.use(koaMount(config_1.default.STATIC.prefix,koaStatic(config_1.default.STATIC.dir))),app.use(views(config_1.default.VIEW.dir,{extension:"ejs"})),app.use(async(e,r)=>{var s=+new Date;await r();new Date}),glob(__dirname+"/controller/*.js").then(e=>Promise.all(e.map(e=>Promise.resolve().then(()=>require(e))))).then(e=>{e.forEach((e,r)=>{e.default(app)})}).catch(e=>{}),"dev"===process.env.NODE_ENV&&(task_1.copyStaticResource(),task_1.createStaticDir());const responseMessage=new responseMessage_1.default;Object.assign(app,{responseMessage:responseMessage}),Object.assign(app,{sequelize:sequelize_1.default}),app.on("error",(e,r)=>{}),exports.default=app;